---
layout: post
title: "[Hot-Deal #2] SHA-256 μ•”νΈν™” μ•κ³ λ¦¬μ¦μΌλ΅ λΉ„λ°€λ²νΈ μ•”νΈν™”"
subtitle: "sha-256 μ•κ³ λ¦¬μ¦μ„ μ΄ν•΄ν•κ³  ν™μ©ν•©λ‹λ‹¤."
categories: devlog
tags: troubleshooting sha-256 password
---

> SHA-256 μ•κ³ λ¦¬μ¦μ„ μ΄ν•΄ν•κ³  ν™μ©ν•©λ‹λ‹¤.

<!--more-->

## π± SHA-256 μ•”νΈν™” μ•κ³ λ¦¬μ¦μΌλ΅ λΉ„λ°€λ²νΈ μ•”νΈν™”

κΈ°λ³Έμ μΌλ΅ λΉ„λ°€λ²νΈλ¥Ό DBμ— μ €μ¥ν•  λ•λ” μ•”νΈν™”ν•μ—¬ μ €μ¥ν•©λ‹λ‹¤. `λ‹¨μν λ³΄μ•μ„ μ„ν•΄` λΌκ³  ν‘ν„ν•  μ μμ§€λ§ 2κ°€μ§€ μ •λ„μ μ΄μ λ¥Ό μ„¤λ…λ“λ¦¬κ³ μ ν•©λ‹λ‹¤.

μ²«λ²μ§Έλ΅λ” νμ‚¬λ„ ν•΄λ‹Ή μ μ €μ λΉ„λ°€λ²νΈλ¥Ό μ• μ μ—†μ–΄μ•Όν•©λ‹λ‹¤. νμ‚¬ λ‚΄μ μ •μ±…μΌλ΅λ„ μ•”νΈν™”λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ„ κ¶μ¥ν•  μ μκ² μµλ‹λ‹¤. μ–΄λ”κ°€μ—μ„ λ“¤λ ¤μ¤λ” μ΄μ•ΌκΈ°λ΅λ” μ μ €κ°€ κ°€μ§€κ³  μλ” μ›¬λ§ν• 
κ°μΈμ •λ³΄(μ£Όμ†, ν΄λ€λ²νΈ λ“±) λν• μ•”νΈν™”ν•μ—¬ μ €μ¥ν•λ‹¤λ” μ΄μ•ΌκΈ°λ¥Ό λ“¤μ€ μ μ΄ μμµλ‹λ‹¤. νμ‚¬ λ‚΄μ—μ„ κ°μΈμ κ°μΈμ •λ³΄λ¥Ό μ• μ μ—†λ„λ΅ DBμ— κ°μΈμ •λ³΄λ¥Ό μ•”νΈν™”ν•μ—¬ μ €μ¥ν•λ‹¤κ³  ν•©λ‹λ‹¤.

λ‘λ²μ§Έλ΅λ” ν•΄ν‚Ήμ— λ€ν• λ°©μ§€μ…λ‹λ‹¤. μΌμ–΄λ‚μ„  μ•λλ” μΌμ΄μ§€λ§, νμ‚¬λ„ ν•΄ν‚Ήμ λ€μƒμ΄ λμ–΄ λ¶μ‹μ— νμ›μ •λ³΄κ°€ μ μ¶λ  μ μμµλ‹λ‹¤. μΌλ°μ μΌλ΅ μ‚¬λλ“¤μ€ λΉ„λ°€λ²νΈλ¥Ό λΉ„μ·ν•κ² κµ¬μ„±ν•μ—¬ μ‚¬μ©ν•λ” κ²½ν–¥μ΄ 
λ§κΈ° λ•λ¬Έμ— ν• λ² ν‰λ¬ΈμΌλ΅ λ λΉ„λ°€λ²νΈκ°€ μ μ¶λλ©΄ λ‹¤λ¥Έ λ„λ©”μΈμ—μ„λ„ κ·Έ λΉ„λ°€λ²νΈλ¥Ό ν™μ©ν• ν•΄ν‚Ήμ μ„ν—μ— λ…Έμ¶λ  μ μμµλ‹λ‹¤.

μ΄λ¬ν• μ΄μ  2κ°€μ§€λ¥Ό κ°€μ§€κ³  μ΄λ² ν”„λ΅μ νΈμ—μ„λ” λΉ„λ°€λ²νΈ μ •λ„λ΅ μ•”νΈν™”λ¥Ό μ§„ν–‰ν•μ—¬ μ €μ¥ν•λ„λ΅ μ¤ν„°λ””ν•μ€μµλ‹λ‹¤.

```java
public class Sha256Util {
  private static final String ENCRYPTION_TYPE = "SHA-256";

  public static EncryptedSourceDto getEncryptDto(String source) {
    String salt = generateSalt();
    String encryptedSource = getEncryptedSourceWithSalt(source, salt);

    return EncryptedSourceDto.builder()
            .encryptedSource(encryptedSource)
            .salt(salt)
            .build();
  }

  public static String getEncryptedSourceWithSalt(String source, String salt) {
    try {
      MessageDigest md = MessageDigest.getInstance(ENCRYPTION_TYPE);

      byte[] byteData = md.digest(source.concat(salt).getBytes());

      return IntStream.range(0, byteData.length)
              .mapToObj(i -> String.format("%02x", byteData[i]))
              .collect(Collectors.joining());
    } catch (NoSuchAlgorithmException e) {
      throw new RuntimeException("SHA-256 μ•”νΈν™” μ—λ¬");
    }
  }

  private static String generateSalt() {
    ThreadLocalRandom random = ThreadLocalRandom.current();

    byte[] salt = new byte[8];
    random.nextBytes(salt);

    StringBuilder sb = new StringBuilder();
    for (byte b : salt) {
      sb.append(String.format("%02x", b));
    }

    return sb.toString();
  }
}

```

λΉ„λ°€λ²νΈ μ•”νΈν™” μ•κ³ λ¦¬μ¦μΌλ΅λ” SHA-256 μ•κ³ λ¦¬μ¦μ„ μ„ νƒν•μ€μµλ‹λ‹¤. SHA-256μ€ λ‹¨λ°©ν–¥ μ•”νΈν™” μ•κ³ λ¦¬μ¦μΌλ΅ λ³µνΈν™”κ°€ λ¶κ°€λ¥ν•λ‹¤λ” νΉμ§•μ„ κ°€μ§€κ³  μμµλ‹λ‹¤. 
ν•μ§€λ§ λΉ„λ°€λ²νΈλ¥Ό ν΄λΌμ΄μ–ΈνΈμ—μ„ μ§μ ‘ λ°›μ•„μ„ λ¬΄μ–Έκ°€λ¥Ό ν•λ” λ™μ‘μ€ μ΅΄μ¬ν•μ§€ μ•μ„ λΏλ”λ¬, λ³µνΈν™”ν•  μ μλ” ν‚¤λ¥Ό μ™Έλ¶€μ— μ κ³µν•λ” κ²ƒμ€ μ„ν—λ¶€λ‹΄μ΄ ν¬λ‹¤κ³  μƒκ°ν•μ—¬ 
λ‹¨λ°©ν–¥ μ•”νΈν™” μ•κ³ λ¦¬μ¦μΌλ΅ λΉ„λ°€λ²νΈλ¥Ό μ•”νΈν™”ν•κΈ°μ— μ¶©λ¶„ν•λ‹¤κ³  νλ‹¨ν•μ€μµλ‹λ‹¤.

μ—¬κΈ°μ„ λ°μƒν•  μ μλ” λ¬Έμ μ μ΄ μ΅΄μ¬ν•©λ‹λ‹¤. λ‹¨μν λΉ„λ°€λ²νΈ ν•λ‚λ¥Ό μ•„λ¬΄λ° μ¶”κ°€μ μΈ μ²λ¦¬μ—†μ΄ ν•΄μ‹±ν•κ² λλ‹¤λ©΄, κ°™μ€ λΉ„λ°€λ²νΈλ¥Ό μ„¤μ •ν• μ μ €λ“¤μ μ•”νΈν™”λ λΉ„λ°€λ²νΈλ” 
λ™μΌν•  κ²ƒμ…λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ ν•΄μ»¤κ°€ `λ μΈλ³΄μ° μ–΄νƒ`, `λΈλ£¨νΈ ν¬μ¤ μ–΄νƒ` λ“±μ λ°©λ²•μ„ ν†µν•΄ λΉ„λ°€λ²νΈκ°€ μ μ¶λ  κ°€λ¥μ„±μ΄ λ†’μµλ‹λ‹¤.

> λ μΈλ³΄μ° μ–΄νƒ : ν•΄μ»¤λ“¤μ΄ λ―Έλ¦¬ μ§€μ •ν•΄λ†“μ€ λ‹¤μ΄μ μ¤νΈλ¥Ό ν™μ©ν•μ—¬ ν•΄μ‹±λ λΉ„λ°€λ²νΈλ¥Ό λ³µνΈν™”ν•λ” λ°©λ²•
> λΈλ£¨νΈ ν¬μ¤ μ–΄νƒ : λ¬΄μ°¨λ³„μ μΌλ΅ λ¨λ“  λ¬Έμλ¥Ό ν•λ²μ‹ λ€μ…ν•΄μ„ λΉ„λ°€λ²νΈλ¥Ό ν’€μ–΄λ‚΄λ” λ°©λ²•

μ΄λ° SHA-256μ λ‹¨μ μ„ λ³΄μ™„ν•κΈ° μ„ν•΄ saltλΌλ” κ²ƒμ„ μ¶”κ°€μ‹ν‚µλ‹λ‹¤. saltλ” μΈμ¦ν•κ³ μ ν•λ” λΉ„λ°€λ²νΈμ— λ¬΄μ‘μ„μ λ¬Έμμ—΄μ„ ν•©ν•μ—¬ ν•¨κ» μ•”νΈν™”ν• λ°©μ‹μ…λ‹λ‹¤. 
κ°™μ€ "12345"λΌλ” λ¬Έμλ¥Ό μ•”νΈν™”ν•λ”λΌλ„ 1λ² "12345"μ— "a"λΌλ” λ¬Έμλ¥Ό μ¶”κ°€ν•μ—¬ μ•”νΈν™”ν•λ” κ²ƒκ³Ό "b"λΌλ” λ¬Έμλ¥Ό μ¶”κ°€ν•μ—¬ μ•”νΈν™”ν•λ” κ²ƒμ΄ λ‹¤λ¥΄λ“―μ΄ saltλ” 
κ°™μ€ λΉ„λ°€λ²νΈλΌν• μ§€λΌλ„ μ„λ΅ λ‹¤λ¥΄κ² μ•”νΈν™”ν•μ—¬ DBμ— μ €μ¥ν•  μ μλ„λ΅ ν•©λ‹λ‹¤. λ¬Όλ΅  μ μ €λ§λ‹¤ κ°€μ§ saltλ” νμ›κ°€μ…μ‹ ν•¨κ» μƒμ„±ν•μ—¬ DBμ— μ €μ¥ν•λ” κ²ƒμΌλ΅ μ„¤κ³„ν•μ€μµλ‹λ‹¤.

μ•„λ λΈ”λ΅κ·Έμ—μ„ μμ„Έν•κ² μ„¤λ…λμ–΄ μμ–΄ μμ„Έν• μ„¤λ…μ€ μƒλµν•©λ‹λ‹¤.

##### π§Ύ μ°Έκ³  Reference
- [ν¨μ¤μ›λ“μ μ•”νΈν™”μ™€ μ €μ¥ - Hash(ν•΄μ‹)μ™€ Salt(μ†”νΈ)](https://st-lab.tistory.com/100)
